<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centro da Construção Civil - Nossos Terrenos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <style>
        /* Estilos CSS completos aqui (mantidos do código original) */
        :root {
            --color-dark: #231F20;
            --color-accent: #D9A91A;
            --color-accent-darker: #404040;
            --color-light: #FFFFFF;
            --color-gray: #f4f4f4;
            --color-shadow: rgba(0, 0, 0, 0.1);
            --font-family: 'Poppins', sans-serif;
            --font-size-h1: clamp(1.8rem, 5vw, 2.8rem);
            --font-size-h2: clamp(1.2rem, 4vw, 1.6rem);
            --font-size-subtitle: clamp(1rem, 3vw, 1.2rem);
            --font-size-body: clamp(0.9rem, 2.5vw, 1rem);
            --font-size-small: clamp(0.85rem, 2vw, 0.95rem);
            --line-fill-percentage: 0%;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
            scroll-padding-top: 100px;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--color-gray);
            color: #333;
            line-height: 1.6;
            font-size: var(--font-size-body);
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* ... (todos os outros estilos mantidos) ... */

        /* Estilos para o botão flutuante de WhatsApp */
        #floating-whatsapp-container {
            position: fixed;
            bottom: 25px;
            right: 25px;
            z-index: 1050;
            display: flex;
            align-items: flex-start;
            transition: transform 0.4s ease-in-out, opacity 0.4s ease-in-out;
        }

        #floating-whatsapp-btn {
            background-color: #25D366;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease, background-color 0.3s ease;
        }

        #floating-whatsapp-btn:hover {
            transform: scale(1.1);
            background-color: #128C7E;
        }

        #floating-whatsapp-btn i {
            font-size: 2rem;
        }

        #close-floating-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #333;
            color: white;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            font-size: 1.2rem;
            line-height: 22px;
            font-weight: bold;
            text-align: center;
            transition: transform 0.3s ease, background-color 0.3s ease;
        }

        #close-floating-btn:hover {
            transform: scale(1.15);
            background-color: #c0392b;
        }

        #floating-whatsapp-container.hidden {
            transform: scale(0);
            opacity: 0;
        }
    </style>
</head>
<body>

<header>
    <div class="container">
        <div class="logo-container">
            <a href="#" id="logo-link"><img src="Imagens/LogoCorreto.png" alt="Logo Centro da Construção Civil" class="logo"></a>
            <h4>Centro da Construção Civil</h4>
        </div>
        
        <nav id="main-nav">
            <ul>
                <li><a href="#">Início</a></li>
                <li><a href="#terrenos">Terrenos</a></li>
                <li><a href="#sobre-nos">Sobre Nós</a></li>
                <li><a href="#contato">Contato</a></li>
            </ul>
        </nav>
        <button id="menu-toggle" type="button" aria-label="Abrir menu de navegação" aria-expanded="false" aria-controls="main-nav">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
        </button>
    </div>
</header>

<main id="terrenos">
    <div class="container">
        <h1 style="text-shadow: 2px 2px 8px rgba(0,0,0,0.3);">Nossos Terrenos Disponíveis</h1>

        <div class="filter-controls">
            <div class="unified-search-container">
                <i class="fa-solid fa-magnifying-glass search-icon" aria-hidden="true"></i>
                <input type="text" id="unified-search-input" placeholder="Pesquise por descrição ou filtre por região">
                <button id="region-filter-btn" type="button" aria-label="Selecionar região" aria-haspopup="true" aria-expanded="false">
                    <i class="fa-solid fa-chevron-down" aria-hidden="true"></i>
                </button>
                <div id="region-dropdown" class="region-dropdown-content">
                    </div>
            </div>
        </div>

        <div id="filter-status" class="visually-hidden" aria-live="polite" aria-atomic="true"></div>

        <div class="listings-container">
            <!-- Cards de terrenos (mantidos do código original) -->
            <div class="listing-card" data-region="Mary Dota" data-address="">
                <div class="visual-container">
                    <div class="carousel">
                        <div class="carousel-images">
                            <img src="https://via.placeholder.com/600x400?text=Terreno+1" alt="Foto do Terreno" class="active">
                            <img src="https://via.placeholder.com/600x400?text=Terreno+2" alt="Foto do Terreno">
                        </div>
                        <button type="button" class="carousel-button prev" aria-label="Imagem anterior"><i class="fas fa-chevron-left" aria-hidden="true"></i></button>
                        <button type="button" class="carousel-button next" aria-label="Próxima imagem"><i class="fas fa-chevron-right" aria-hidden="true"></i></button>
                    </div>
                    <button type="button" class="open-map-btn" aria-label="Ver no mapa">
                        <i class="fa-solid fa-map-location-dot" aria-hidden="true"></i>
                    </button>
                </div>
                <div class="details">
                    <h2>Terreno no Vista Bela</h2>
                    <p class="location">Bauru, SP</p>
                    <p class="description">Lote com medidas acima do padrão (10x20), localizado na parte alta do bairro. Proximidades: Casa Portugal Material de Construção, Capela Santo Expedito e Parque Giansante.</p>
                    <div class="info">
                        <span><i class="fa-solid fa-ruler-combined" aria-hidden="true"></i> Área: <strong>200 m²</strong></span>
                        <span><i class="fa-solid fa-bed" aria-hidden="true"></i> Casa 1 Quarto: <strong>R$ 172.900,00</strong></span>
                        <span><i class="fa-solid fa-bed" aria-hidden="true"></i> Casa 2 Quartos: <strong>R$ 207.400,00</strong></span>
                    </div>
                    <div class="card-actions">
                        <button class="cta-button" data-nome="Terreno Isaura Pitta Garms" type="button">
                            <i class="fa-brands fa-whatsapp" aria-hidden="true"></i> Faça Simulação
                        </button>
                        <button class="details-button" data-nome="Terreno Isaura Pitta Garms" type="button">Saber Mais</button>
                    </div>
                </div>
            </div>

            <!-- Mais cards de terrenos... -->
        </div>
    </div>
</main>

<footer id="contato">
    <div class="container">
        <div class="footer-content">
            <div id="sobre-nos" class="footer-section">
                <h3>Sobre o Centro da Construção Civil</h3>
                <p>Com anos de experiência no mercado imobiliário de Bauru e região, somos especialistas em conectar você ao terreno ideal para o seu projeto de vida. Transparência e confiança são nossos pilares.</p>
            </div>
            <div class="footer-section">
                <h3>Contato e Redes Sociais</h3>
                <p><i class="fa-solid fa-phone" aria-hidden="true"></i> <a href="tel:+5514997456960">(14) 99745-6960</a></p>
                <p><i class="fa-solid fa-envelope" aria-hidden="true"></i> <a href="mailto:contatocentrodaconstrucaocivil@gmail.com">contatocentrodaconstrucaocivil@gmail.com</a></p>
                <p><i class="fa-brands fa-instagram" aria-hidden="true"></i> <a href="https://www.instagram.com/centrodaconstrucaocivil/" target="_blank" rel="noopener noreferrer">@centrodaconstrucaocivil</a></p>
                <p><i class="fa-brands fa-facebook" aria-hidden="true"></i> <a href="https://www.facebook.com/centrodaconstrucaocivil" target="_blank" rel="noopener noreferrer">/centrodaconstrucaocivil</a></p>
                <p><i class="fa-solid fa-location-dot" aria-hidden="true"></i> <span>R. Gustavo Maciel, 7-02 - Centro, Bauru - SP, 17010-180</span></p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 Centro da Construção Civil. Todos os direitos reservados.</p>
        </div>
    </div>
</footer>

<div id="saber-mais-modal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="modal-title" hidden>
    <div class="modal-content">
        <button id="modal-close-btn" class="modal-close" type="button" aria-label="Fechar modal">&times;</button>
        <h2 id="modal-title" class="modal-title-text"></h2>
        
        <div class="modal-info-container">
            <div class="info-box">
                <h3>Primeiro Passo</h3>
                <p>Parabéns! Você selecionou o <strong>"Nome do terreno"</strong>. Agora é só seguir os próximos passos para realizar seu sonho.</p>
            </div>
            <div class="info-box">
                <h3>Segundo Passo</h3>
                <p>Deseja saber os valores do terreno já com a contrução,é bem simples.</p>
            </div>
            <div class="info-box">
                <h3>Terceiro Passo</h3>
                <p>Basta clicar no botão verde que você sera enviado direto para o nosso WhatsApp.</p>
            </div>
        </div>

        <button id="modal-cta-button" class="cta-button" type="button" data-nome="">
            <i class="fa-brands fa-whatsapp" aria-hidden="true"></i> Faça Simulação
        </button>
    </div>
</div>

<div id="map-modal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="map-modal-title" hidden>
    <div class="modal-content">
        <button id="map-modal-close-btn" class="modal-close" type="button" aria-label="Fechar mapa">&times;</button>
        <h2 id="map-modal-title" class="modal-title-text">Localização do Terreno</h2>
        <div id="map-modal-container"></div>
    </div>
</div>

<div id="floating-whatsapp-container">
    <button id="close-floating-btn" type="button" aria-label="Fechar botão do WhatsApp">&times;</button>
    <button id="floating-whatsapp-btn" type="button" aria-label="Abrir WhatsApp">
        <i class="fa-brands fa-whatsapp"></i>
    </button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // Lista de números de vendedores permitidos (formato internacional sem caracteres especiais)
    const NUMEROS_PERMITIDOS = [
        '5514997456960',
        '5514997313826',
        '5514998133326',
        '5514996097357',
        '5514998003033'  // Exemplo - substitua pelos números reais
    ];

    document.addEventListener('DOMContentLoaded', function() {
        // Restaurar a posição do scroll para o topo ao carregar a página
        if (history.scrollRestoration) {
            history.scrollRestoration = 'manual';
        }
        window.scrollTo(0, 0);

        // --- LÓGICA "VER MAIS" / "VER MENOS" PARA AS DESCRIÇÕES ---
        const listingCardsForDesc = document.querySelectorAll('.listing-card');
        listingCardsForDesc.forEach((card, index) => {
            const desc = card.querySelector('.details .description');
            if (!desc) return;

            if (desc.scrollHeight > parseFloat(getComputedStyle(desc).fontSize) * 1.6 * 3) {
                desc.classList.add('description-collapsed');
                
                const toggleButton = document.createElement('button');
                toggleButton.innerText = 'Ver mais';
                toggleButton.className = 'read-more-btn';
                const descId = `desc-${index}`;
                desc.id = descId;
                toggleButton.setAttribute('aria-expanded', 'false');
                toggleButton.setAttribute('aria-controls', descId);
                desc.after(toggleButton);
                
                toggleButton.addEventListener('click', function() {
                    const isCollapsed = desc.classList.contains('description-collapsed');
                    
                    if (isCollapsed) {
                        desc.classList.remove('description-collapsed');
                        desc.style.maxHeight = desc.scrollHeight + 'px';
                        this.innerText = 'Ver menos';
                        this.setAttribute('aria-expanded', 'true');
                    } else {
                        desc.style.maxHeight = null;
                        desc.classList.add('description-collapsed');
                        this.innerText = 'Ver mais';
                        this.setAttribute('aria-expanded', 'false');
                    }
                });
            }
        });

        // --- LÓGICA DE FILTRAGEM UNIFICADA ---
        const searchInput = document.getElementById('unified-search-input');
        const regionFilterBtn = document.getElementById('region-filter-btn');
        const regionDropdown = document.getElementById('region-dropdown');
        const listingCards = document.querySelectorAll('.listing-card');
        const filterStatus = document.getElementById('filter-status');
        const logoLink = document.getElementById('logo-link');
        let currentRegion = 'all';

        const originalPlaceholder = "Pesquise por descrição ou filtre por região";
        const shortPlaceholder = "Pesquisar ou filtrar por região";

        function adjustPlaceholder() {
            if (searchInput && window.innerWidth <= 500) {
                searchInput.placeholder = shortPlaceholder;
            } else if (searchInput) {
                searchInput.placeholder = originalPlaceholder;
            }
        }
        
        function populateRegionDropdown() {
            if (!regionDropdown) return;
            const regions = new Set();
            listingCards.forEach(card => {
                if (card.dataset.region) {
                    regions.add(card.dataset.region);
                }
            });

            regionDropdown.innerHTML = '';

            const allRegionsBtn = document.createElement('button');
            allRegionsBtn.textContent = 'Todas as Regiões';
            allRegionsBtn.dataset.region = 'all';
            allRegionsBtn.classList.add('active-region');
            regionDropdown.appendChild(allRegionsBtn);

            regions.forEach(region => {
                const regionBtn = document.createElement('button');
                regionBtn.textContent = region;
                regionBtn.dataset.region = region.toLowerCase();
                regionDropdown.appendChild(regionBtn);
            });
        }

        function applyFilters() {
            const searchTerm = searchInput ? searchInput.value.toLowerCase().trim() : '';
            let visibleCount = 0;

            listingCards.forEach(card => {
                const cardRegion = card.dataset.region ? card.dataset.region.toLowerCase() : '';
                const regionMatch = (currentRegion === 'all' || cardRegion === currentRegion);
                const cardDescription = card.querySelector('.description')?.textContent.toLowerCase() || '';
                const searchMatch = cardDescription.includes(searchTerm);

                if (regionMatch && searchMatch) {
                    card.classList.remove('hidden');
                    visibleCount++;
                } else {
                    card.classList.add('hidden');
                }
            });

            if (filterStatus) {
                filterStatus.textContent = `${visibleCount} terreno(s) encontrado(s).`;
            }
        }

        function resetFiltersAndSearch(event) {
            if(event) event.preventDefault();
            if (searchInput) searchInput.value = '';
            currentRegion = 'all';
            applyFilters();
            
            if (regionDropdown) {
                regionDropdown.querySelectorAll('button').forEach(btn => {
                    btn.classList.remove('active-region');
                });
                const allRegionsBtn = regionDropdown.querySelector('button[data-region="all"]');
                if (allRegionsBtn) {
                    allRegionsBtn.classList.add('active-region');
                }

                if (regionDropdown.classList.contains('show')) {
                    regionDropdown.classList.remove('show');
                    if (regionFilterBtn) regionFilterBtn.setAttribute('aria-expanded', 'false');
                }
            }
        }

        if (searchInput && regionFilterBtn && regionDropdown && listingCards.length > 0) {
            populateRegionDropdown();
            adjustPlaceholder();
            window.addEventListener('resize', adjustPlaceholder);

            regionFilterBtn.addEventListener('click', () => {
                const isExpanded = regionFilterBtn.getAttribute('aria-expanded') === 'true';
                regionFilterBtn.setAttribute('aria-expanded', !isExpanded);
                regionDropdown.classList.toggle('show');
            });
            
            regionDropdown.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    regionDropdown.querySelectorAll('button').forEach(btn => {
                        btn.classList.remove('active-region');
                    });
                    e.target.classList.add('active-region');

                    currentRegion = e.target.dataset.region; 
                    applyFilters();
                    regionDropdown.classList.remove('show');
                    regionFilterBtn.setAttribute('aria-expanded', 'false');
                }
            });
            
            searchInput.addEventListener('input', applyFilters);

            if(logoLink) {
                logoLink.addEventListener('click', resetFiltersAndSearch);
            }

            window.addEventListener('click', (e) => {
                if (regionFilterBtn && !regionFilterBtn.contains(e.target) && !regionDropdown.contains(e.target)) {
                    if (regionDropdown.classList.contains('show')) {
                        regionDropdown.classList.remove('show');
                        regionFilterBtn.setAttribute('aria-expanded', 'false');
                    }
                }
            });
        }
        
        // --- LÓGICA PARA O MENU HAMBÚRGUER ---
        const menuToggle = document.getElementById('menu-toggle');
        const mainNav = document.getElementById('main-nav');
        if (menuToggle && mainNav) {
            const header = document.querySelector('header');
            const navLinks = mainNav.querySelectorAll('a');

            const setNavTop = () => {
                const headerHeight = header.offsetHeight;
                mainNav.style.top = `${headerHeight}px`;
                mainNav.style.height = `calc(100vh - ${headerHeight}px)`;
            };

            menuToggle.addEventListener('click', function() {
                setNavTop();
                const isActive = mainNav.classList.toggle('active');
                this.classList.toggle('active');
                this.setAttribute('aria-expanded', isActive);
                document.body.style.overflow = isActive ? 'hidden' : '';
            });

            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    if (mainNav.classList.contains('active')) {
                        mainNav.classList.remove('active');
                        menuToggle.classList.remove('active');
                        menuToggle.setAttribute('aria-expanded', 'false');
                        document.body.style.overflow = '';
                    }
                });
            });
        }

        // --- LÓGICA UNIFICADA PARA TODOS OS CARROSSEIS ---
        document.querySelectorAll('.carousel').forEach(carousel => {
            const images = carousel.querySelectorAll('.carousel-images img');
            const prevButton = carousel.querySelector('.carousel-button.prev');
            const nextButton = carousel.querySelector('.carousel-button.next');
            let currentIndex = 0;

            if (images.length <= 1) {
                 if(prevButton) prevButton.style.display = 'none';
                 if(nextButton) nextButton.style.display = 'none';
                 return; 
            }

            function showImage(index) {
                images.forEach((img, i) => {
                    img.classList.toggle('active', i === index);
                    img.setAttribute('aria-hidden', i !== index);
                });
            }
            
            prevButton?.addEventListener('click', () => {
                currentIndex = (currentIndex - 1 + images.length) % images.length;
                showImage(currentIndex);
            });

            nextButton?.addEventListener('click', () => {
                currentIndex = (currentIndex + 1) % images.length;
                showImage(currentIndex);
            });
            
            showImage(currentIndex);
        });
        
        // --- FUNÇÃO CENTRALIZADA PARA ABRIR WHATSAPP (COM VALIDAÇÃO) ---
        function openWhatsAppSimulation(nomeTerreno) {
            const urlParams = new URLSearchParams(window.location.search);
            const numeroDoVendedor = urlParams.get('vendedor');
            const numeroPadrao = '5514997456960';
            
            // Verificar se o número da URL está na lista de permitidos
            const numeroWhatsApp = numeroDoVendedor && NUMEROS_PERMITIDOS.includes(numeroDoVendedor) 
                ? numeroDoVendedor 
                : numeroPadrao;
            
            const mensagem = encodeURIComponent(`Olá! Gostaria de fazer uma simulação para o terreno: "${nomeTerreno}". Poderia me dar mais informações?`);
            const whatsappURL = `https://wa.me/${numeroWhatsApp}?text=${mensagem}`;
            window.open(whatsappURL, '_blank', 'noopener,noreferrer');
        }

        // --- LÓGICA PARA O BOTÃO "Faça Simulação" (WHATSAPP) NOS CARDS ---
        document.querySelectorAll('.card-actions .cta-button').forEach(button => {
            button.addEventListener('click', function() {
                const nomeTerreno = this.dataset.nome;
                openWhatsAppSimulation(nomeTerreno);
            });
        });

        // ==============================================================
        // ===  LÓGICA DO MODAL "SABER MAIS" (VERSÃO COMPLETA RESTAURADA) ===
        // ==============================================================
        const saberMaisModal = document.getElementById('saber-mais-modal');
        if (saberMaisModal) {
            const modalTitle = document.getElementById('modal-title');
            const modalCtaButton = document.getElementById('modal-cta-button');
            const closeModalBtn = document.getElementById('modal-close-btn');
            const infoBoxes = saberMaisModal.querySelectorAll('.modal-info-container .info-box');

            document.querySelectorAll('.details-button').forEach(button => {
                button.addEventListener('click', function() {
                    const nomeTerreno = this.dataset.nome;
                    
                    modalTitle.textContent = "Três Passos para realizar o Sonho Da Casa Própria";
                    
                    infoBoxes[0].querySelector('p').innerHTML = `Parabéns! Você selecionou o <strong>"${nomeTerreno}"</strong>. Agora é só seguir os próximos passos para realizar seu sonho.`;
                    
                    modalCtaButton.dataset.nome = nomeTerreno;

                    // Reseta o estado do modal ao abrir
                    infoBoxes.forEach(box => box.classList.remove('clicked'));
                    modalCtaButton.classList.remove('pulse-animation');
                    document.documentElement.style.setProperty('--line-fill-percentage', '0%');

                    saberMaisModal.removeAttribute('hidden');
                    saberMaisModal.classList.add('show');
                    document.body.style.overflow = 'hidden';
                });
            });

            infoBoxes.forEach((box, index) => {
                box.addEventListener('click', () => {
                    box.classList.add('clicked');

                    let fillPercentage = 0;
                    if (index === 1) fillPercentage = 50;
                    else if (index === 2) fillPercentage = 100;

                    document.documentElement.style.setProperty('--line-fill-percentage', `${fillPercentage}%`);

                    if (index === 2) {
                        modalCtaButton.classList.add('pulse-animation');
                    } else {
                        modalCtaButton.classList.remove('pulse-animation');
                    }
                });
            });

            function closeModal() {
                saberMaisModal.classList.remove('show');
                document.body.style.overflow = '';
                setTimeout(() => {
                    saberMaisModal.setAttribute('hidden', 'true');
                }, 300);
            }

            closeModalBtn.addEventListener('click', closeModal);
            saberMaisModal.addEventListener('click', function(e) {
                if (e.target === saberMaisModal) {
                    closeModal();
                }
            });
            window.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && saberMaisModal.classList.contains('show')) {
                    closeModal();
                }
            });

            // Ação do botão de simulação DENTRO do modal "Saber Mais"
            modalCtaButton.addEventListener('click', function() {
                const nomeTerreno = this.dataset.nome;
                openWhatsAppSimulation(nomeTerreno);
            });
        }
        
        // ========================================================================
        // === LÓGICA PARA O MODAL DO MAPA (COM CORREÇÃO DE CORS) ===============
        // ========================================================================
        const mapModal = document.getElementById('map-modal');
        const mapModalContainer = document.getElementById('map-modal-container');
        const mapModalTitle = document.getElementById('map-modal-title');
        const closeMapBtn = document.getElementById('map-modal-close-btn');
        let mapInstance = null;

        const closeMapModal = () => {
            if (!mapModal) return;
            mapModal.classList.remove('show');
            document.body.style.overflow = '';
            setTimeout(() => {
                mapModal.setAttribute('hidden', 'true');
                if (mapInstance) {
                    mapInstance.remove();
                    mapInstance = null;
                }
                if (mapModalContainer) mapModalContainer.innerHTML = '';
            }, 300);
        };

        if (mapModal && mapModalContainer && mapModalTitle && closeMapBtn) {
            document.querySelectorAll('.open-map-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const card = button.closest('.listing-card');
                    if (!card) return;

                    const address = card.dataset.address;
                    const title = card.querySelector('h2').textContent;

                    if (!address) {
                        alert('Endereço não disponível para este terreno.');
                        return;
                    }

                    mapModalTitle.textContent = title;
                    mapModalContainer.innerHTML = '<p style="text-align:center; padding-top: 45vh; font-size: 1.2rem; color: #666;">Buscando localização...</p>';
                    mapModal.removeAttribute('hidden');
                    mapModal.classList.add('show');
                    document.body.style.overflow = 'hidden';
                    
                    const userEmail = "luccasiniciati@gmail.com"; 
                    const apiUrl = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}&email=${userEmail}`;

                    setTimeout(() => {
                        fetch(apiUrl)
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error(`Erro de rede: ${response.statusText} (Status: ${response.status})`);
                                }
                                return response.json();
                            })
                            .then(data => {
                                if (data && data.length > 0) {
                                    const lat = data[0].lat;
                                    const lon = data[0].lon;
                                    const location = [lat, lon];
                                    
                                    mapModalContainer.innerHTML = '';

                                    mapInstance = L.map('map-modal-container', {
                                        scrollWheelZoom: true
                                    }).setView(location, 16);

                                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                                        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                                    }).addTo(mapInstance);

                                    L.marker(location).addTo(mapInstance)
                                        .bindPopup(title)
                                        .openPopup();
                                } else {
                                    mapModalContainer.innerHTML = '<p style="text-align:center; padding-top: 45vh; font-size: 1.2rem; color: #d9534f;">Endereço não encontrado no mapa.</p>';
                                }
                            })
                            .catch(error => {
                                console.error('Falha na requisição fetch:', error);
                                mapModalContainer.innerHTML = '<p style="text-align:center; padding-top: 45vh; font-size: 1.2rem; color: #d9534f;">Erro ao carregar o mapa. Verifique o console para detalhes.</p>';
                            });
                    }, 150);
                });
            });

            closeMapBtn.addEventListener('click', closeMapModal);
            mapModal.addEventListener('click', e => e.target === mapModal && closeMapModal());
            window.addEventListener('keydown', e => e.key === 'Escape' && mapModal.classList.contains('show') && closeMapModal());
        }

        // ==============================================================
        // ===  NOVO: LÓGICA PARA ANIMAR ELEMENTOS AO ROLAR A PÁGINA   ====
        // ==============================================================
        const animatedElements = document.querySelectorAll('.listing-card');

        if (animatedElements.length > 0) {
            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    // Se o elemento está intersectando (visível na tela)
                    if (entry.isIntersecting) {
                        // Adiciona as classes de animação
                        entry.target.classList.add('animate__animated', 'animate__fadeInUp');
                        // Para de observar o elemento para a animação não repetir
                        observer.unobserve(entry.target);
                    }
                });
            }, {
                threshold: 0.1 // A animação começa quando 10% do elemento estiver visível
            });

            // Inicia a observação para cada card
            animatedElements.forEach(element => {
                observer.observe(element);
            });
        }

        // ==============================================================
        // ===  NOVO: LÓGICA PARA O BOTÃO FLUTUANTE DO WHATSAPP      ====
        // ==============================================================
        const floatingContainer = document.getElementById('floating-whatsapp-container');
        const floatingBtn = document.getElementById('floating-whatsapp-btn');
        const closeFloatingBtn = document.getElementById('close-floating-btn');

        if (floatingContainer && floatingBtn && closeFloatingBtn) {
            // Ação para o botão flutuante principal
            floatingBtn.addEventListener('click', function() {
                // Reutiliza a função já existente, mas com uma mensagem genérica
                const urlParams = new URLSearchParams(window.location.search);
                const numeroDoVendedor = urlParams.get('vendedor');
                const numeroPadrao = '5514997456960';
                
                const numeroWhatsApp = numeroDoVendedor && NUMEROS_PERMITIDOS.includes(numeroDoVendedor) 
                    ? numeroDoVendedor 
                    : numeroPadrao;
                
                const mensagem = encodeURIComponent('Olá! Visitei o site e gostaria de mais informações sobre os terrenos.');
                const whatsappURL = `https://wa.me/${numeroWhatsApp}?text=${mensagem}`;
                window.open(whatsappURL, '_blank', 'noopener,noreferrer');
            });

            // Ação para o botão de fechar
            closeFloatingBtn.addEventListener('click', function(event) {
                event.stopPropagation(); // Impede que o clique no 'x' acione o botão principal
                floatingContainer.classList.add('hidden');
            });
        }
    });
</script>

</body>
</html>